<%= javascript_pack_tag 'items' %>
<h1><%= @list.title.titleize %></h1>
<h4>Created by - <%= @list.user.name.titleize %></h4>
<% if @list.percent_complete.present? %>
  <h4><%= @list.percent_complete %>% completed</h4>
<% end %>
<% if not_joined?(@list) %>
  <%= link_to "Join", user_list_join_path(current_user, @list), method: :post, class: 'btn btn-primary join-btn pull-right' %>
<% elsif @list.user != current_user %>
  <%= link_to "Leave", user_list_leave_path(current_user, @list), method: :delete, class: 'btn btn-primary join-btn pull-right' %>
<% end %>
<div class="container">
  <% if policy(@list).edit? %>
    <%= link_to "Edit", edit_user_list_path(@user, @list), id: "edit-list-#{@list.id}", class: "btn btn-primary" %>
    <%= link_to "Delete", list_path(@list), method: "delete", id: "delete-list-#{@list.id}", class: "btn btn-danger", data: { confirm: "Are you sure?" } %>
  <% end %>
  <% if @list.present? %>
    <%= time_left_until_due(@list.due_date) %>
  <% end %>
  <br>
  <h3>Collaborators</h3>
  <ol>
    <% @list.collaborators.each do |user| %>
      <% if user == current_user %>
        <li><%= link_to 'Me', user_path(user) %></li>
      <% else %>
        <li><%= link_to user.name.titleize, user_path(user) %></li>
      <% end %>
    <% end %>
  </ol>
  <% if policy(@list).new? %>
  <%= link_to raw("&#43;"), new_list_item_path(@list), role: "button", class: "add-btn btn" %>
    <div class="list-group">
      <% @items.each do |item| %>
        <div class="well list-items">
          <div class="row">
            <div class="col-xs-12 col-md-7">
              <h3><%= link_to item.title, list_item_path(@list, item) %></h3>
            </div>
            <div class="col-xs-6 col-md-3">
              <% if policy(item).edit? %>
                <%= link_to "Edit", edit_list_item_path(@list, item), id: "edit-item-#{item.id}", class: "btn btn-default element-inline" %>
                <%= link_to "Delete", list_item_path(@list, item), method: "delete", id: "delete-item-#{item.id}", class: "btn btn-danger element-inline", data: { confirm: "Are you sure?" } %>
              <% end %>
            </div>
            <div class="col-xs-6 col-md-2">
              <%= form_for [@list, item], method: :put, url: [@list,item, :complete] do |f| %>
                <%= f.hidden_field :id, value: item.id %>
                <%= f.hidden_field :list_id, value: @list.id %>
                <%= f.hidden_field :user_id, value: item.user.id %>
                <%= f.hidden_field :date_completed, value: format_date_to_ISO(item.date_completed), class: "js-item-date-completed" %>
                <%= f.check_box :completed, { "data-onstyle": "success", "data-offstyle": "warning", "data-toggle": "toggle", "data-on": "Completed", "data-off": "Incomplete", class: "js-item-completed" } %>
              <% end %>
              <p class="js-item-human-date"></p>
            </div>
          </div>
          <small>footnote</small>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
